(()=>{"use strict";const e=e=>(e.slice(e.indexOf("("),e.indexOf(")")),e.slice(e.indexOf("(")+1,e.indexOf(")")));var t=new class{ConnectToCamera(){console.log("constr")}sync(){}getCameraConfig(e){let t=this.__makeUrl(["getsettings"]);this.objSettings=e,this.__executeAjax(t,(t=>e.renderSettigsPage(t)))}getImportantSettings(e){let t=this.__makeUrl(["settings","important"]);this.__executeAjax(t,(t=>e.renderImportantSettingPage(t)))}editCompressCurrCapture([e,t],n){let a=this.__makeUrl(["compress"]);this.__executeAjax(a,n,{сoeff_compress:e,coeff_resize:t},"POST")}reloadCamera(e){let t=this.__makeUrl(["put","reload"]);this.__executeAjax(t,(e=>console.log(e)))}init(e,t){this.endpoint=e,this.__localSaveData=null,this.condition=null,this.localFiles={},this.currImg=null,this.rootUrlApi="api",this.successInitCamera=null,this.__executeAjax(this.__makeUrl("login"),t)}getImgByName(e,t,n=10,a=100){let o=this.__makeUrl(["get",e]);this.__executeAjax(o,t,{сoeff:n,coeff_compress:a},"POST")}delFileByName(e,t){let n=this.__makeUrl(["del",e]);this.__executeAjax(n,t(e)),console.log("delFileByNAme")}capture(e){let t=this.__makeUrl("capture");this.__executeAjax(t,e)}__executeAjaxPromise(e,t){return new Promise(((n,a)=>{const o=new XMLHttpRequest;o.open("GET",e),o.addEventListener("load",(()=>{o.status>=200&&o.status<400?n(o.response):a(new Error(`Request failed: ${o.statusText}`))})),o.addEventListener("error",(()=>a(new Error("Network error")))),o.send(t)}))}syncWithCamera(e){let t=this.__makeUrl("refresh");this.__executeAjax(t,e)}changeSettingsCamera(e,t){let n=this.__makeUrl(["post","settings"]);this.__executeAjax(n,(e=>console.log(e)),{changedData:e},"post"),console.log(e)}__makeUrl(e){var t="http://"+this.endpoint+"/"+this.rootUrlApi;return Array.isArray(e)?e.forEach((e=>{t+="/"+e})):t+="/"+e,t+"/"}getInfoFilesys(e){let t=this.__makeUrl(["infosys"]);this.__executeAjax(t,e)}getAllFiles(e){let t=this.__makeUrl(["get","all"]);this.__executeAjax(t,e)}__executeAjax(e,t,n=null,a="get",o=null){console.log(e),null==o&&(o=(e,t)=>{alert(e.responseText),console.log(e)}),$.ajax({url:e,method:a,dataType:"json",data:{params:n},success:t,error:o})}},n=new class{importantSettings=["iso","shutterspeed2","exposurecompensation","f-number","shutterspeed","iso","whitebalance","autoiso","exposurecompensation"];bind={};actualSettings={};renderSettigsPage(t,n="#md-header",a="#myTabContent"){let o=this.renderTabsHtml(t);$("#md-header").html(o[0]),$("#myTabContent").html(o[1]);for(let n in t){this.bind[e(n)]="";for(let a in t[n])this.actualSettings[e(a)]=t[n][a].value,this.bind[e(n)]+=this.parseTypeForm(t[n][a],a)??""}this.addForms()}constructor(e,t="#md-header",n="#myTabContent"){}__safeGetId(t){var n={};for(let a in t)n[e(a)]=t[a].value;return n}renderImportantSettingPage(e,t="#importantSettings_body"){console.log("test"),this.actualImportantSettings=this.__safeGetId(e);let n="";for(let t in e)n+=this.parseTypeForm(e[t],t,"_important");$(t).html(n)}renderTabsHtml(t){let n='<ul class="nav nav-tabs" id="myTab" role="tablist">',a="",o=0;for(let s in t)a+=`\n            <div class="tab-pane fade ${0==o?"show active":""}" id="${e(s)}" role="tabpanel" aria-labelledby="Camera Settings (settings)">\n                <h1>${s}</h1>\n            </div>`,n+=` \n            <li class="nav-item" role="presentation"> \n                <button class="nav-link ${0==o?"active":""}"" id="${o++}" data-bs-toggle="tab" data-bs-target="#${e(s)}" type="button" role="tab" aria-controls="home" aria-selected="true">${s}</button>\n            </li>\n            `;return n+="</ul>>",[n,a]}editImportantSettings(){var e=[];return $("input, select","#importantSettings_body").each((function(t){let n=$(this).attr("id");null===$(this).val()?e[n.split("_")[0]]=0:"checkbox"==$(this).attr("type")||(e[n.split("_")[0]]=$(this).val())})),this.findСhangedInput(e,this.actualImportantSettings)}parseCurrSettings(){let e={};return $("input, select",".modal-content").each((function(t){let n=$(this).attr("id");null===$(this).val()?e[n]=0:"checkbox"==$(this).attr("type")||(e[n]=$(this).val())})),this.findСhangedInput(e,this.actualSettings)}addForms(){for(let e in this.bind)$(`#${e}`).html(this.bind[e])}parseTypeForm(e,t,n=""){return"ToggleWidget"==e.type?this.getFormToggle(e,t,n):"RangeWidget"==e.type?this.getFormRange(e,t,n):"TextWidget"==e.type?this.getFormText(e,t,n):"RadioWidget"==e.type||"MenuWidget"==e.type?this.getFormMenu(e,t,n):"Date"==e.type?this.getFormDate(e,t,n):void 0}addOptionTags(e){let t="";return t+=1==e.isReadOnly?"disabled":"",t+=0!=e.value?" checked ":"",t}getFormToggle(t,n,a){let o="";return o+="<div class='input_toggle form-group row'>",o+=`\n       \n            \n            <label class="col-form-label col-sm-4" for="${e(n)+a}">\n                ${n} :  \n            </label>\n\n            <div class="col-sm-8">\n                <input class="form-check-input" type="checkbox" value="" id="${e(n)+a}" ${this.addOptionTags(t)}>\n            </div>\n        \n        `,o+="</div>",o}getFormDate(e,t,n){return e.value=this.timeConverter(e.value),this.getFormText(e,t,n)}timeConverter(e){var t=new Date(1e3*e),n=t.getFullYear(),a=t.getMonth();return t.getDate()+" "+a+" "+n+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}getFormRange(t,n,a){let o="";return o="<div class='input_range form-group row'>",o+=`\n            <label for="${e(n)+a}" class="col-form-label col-sm-4">${n}}</label>\n            <div class="col-sm-8">\n                <input type="range" class="form-range" value="${t.value}" min="${t.range[0]}" max="${t.range[1]}" step="${t.range[2]}" id="${e(n)+a}"  ${this.addOptionTags(t)}>\n            </div>\n                `,o+="</div>",o}getFormText(t,n,a){let o="<div class='input_text form-group row'>";return o+=`<label for="${e(n)+a}" class="col-form-label col-sm-4">${n}</label>`,o+=`\n        <div class="col-sm-8">\n            <input class="form-control" type="text" value="${t.value}" placeholder="Disabled input" id="${e(n)+a}" aria-label="Disabled input example" ${this.addOptionTags(t)}></input>\n        </div>\n        \n            `,o+="</div>",o}findСhangedInput(e,t){let n={};for(let a in e)"datetime"!=a&&"flashexposurecompensation"!=a&&"thumbsize"!=a&&e[a]!=t[a]&&null!=t[a]&&(n[a]=e[a]);return n}getFormMenu(t,n,a){let o='<div class="input_menu form-group row">';return o+=`<label for="${e(n)+a}" class="col-form-label col-sm-4">${n}</label>`,o+=`\n        <div class="col-sm-8">\n            <select id="${e(n)+a}" class="form-select" value=${t.value} aria-label="Default select example"> ${this.addOptionTags(t)}`,t.choice.forEach((e=>{e==t.value?o+=`<option selected> ${e} </option>`:o+=`<option value="${e}">${e}</option>`})),o+="</select>",o+="</div>",o+="</div>",o}};let a=(e,t)=>{var n,a=t.name,o=t.path,s=t.info.image_dimensions,i=t.info.image_type,r=t.info.file_mtime;e.prepend(` \n        <tr id='${l(a)}'>\n            <td> ${a} </td>\n            <td> ${o} </td>\n            <td> ${s} </td>\n            <td> ${i} </td>\n            <td> ${r} </td>\n          \n            <td> ${n=a,`\n    <div class="btn-group">\n        <button type="button" class="btn btn-success">Действие</button>\n        <button type="button" class="btn btn-success dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">\n        <span class="visually-hidden">Переключатель выпадающего списка</span>\n        </button>\n        <ul class="dropdown-menu">\n            <li>\n                <a class="dropdown-item" href="#">\n                    <button class="nav-link px-3 control_button btn btn-warning" id="${n}:del">del</button>\n            \n                </a>\n            </li>\n            <li>\n                <a class="dropdown-item" href="#">\n                    <button style="color:white" class="nav-link px-3 control_button btn btn-primary" id="${n}:get">get</button>\n                </a>\n            </li>\n            <li><a class="dropdown-item" href="#">Что-то еще здесь</a></li>\n            <li><hr class="dropdown-divider"></li>\n            <li><a class="dropdown-item" href="#">Отделенная ссылка</a></li>\n        </ul>\n  </div>\n    `} </td>\n\n        </tr> \n    `)};const o=e=>{$("#prew_img").html(`<img widht="400px" height="400px" src="${e.urlImgPreview}">`),$("#img_panzoom").attr("src",`${e.urlImgResize}`),alert("")},s=()=>{p("test"),$("#connect_to_camera").html("Активно"),$("#connect_to_camera").css("background-color","mediumspringgreen"),$("#connect_to_camera").css("color","purple")},l=e=>{let t=e.indexOf("_"),n=e.indexOf(".");return e.substring(t+1,n)},i=e=>{let t=l(e);$("#"+t).remove()},r=e=>{var[n,a]=e.target.id.split(":");switch(a){case"get":$("#exampleModalCenter").modal("toggle"),$("#get_photo").click((e=>{let a=$("#inputResizeImg").val(),s=$("#inputCoeffCompress").val();t.getImgByName(n,o,a,s),$("#get_photo").off(),$("#exampleModalCenter").modal("toggle")}));break;case"del":t.delFileByName(n,i)}},c=e=>{var t=$("#tbody_info_files");console.log(e),o(e),a(t,e),d()},d=()=>{let e=$(".control_button");e.off(),e.click(r)},m=e=>{u(e)},u=e=>{$(".control_button").remove();var t=$("#tbody_info_files");for(var n in t.empty(),e){let o=e[n];o.name=n,a(t,o)}e=null,t=null,d()},g=1073741824,p=e=>{var t=document.getElementById("toast_id");new bootstrap.Toast(t).show()},_=e=>{let t=e.free_space_camera,n=e.free_space_odroid.used,a=e.free_space_odroid.total,o=n/a,s=$("#info_space_odroid"),l=s.attr("max");s.val(l*o);let i=$("#info_space_camera");l=i.attr("max"),$("#odroid_info").append(`\n        <span class="progress-value"> Используется : ${(n/g).toFixed(4)} ГБ </span>\n        <span class="progress-value"> Всего : ${(a/g).toFixed(4)} ГБ </span> \n        `),i.val(l*(t/100))};((e="#settings_page",t="#settings-path")=>{$(e).click((e=>{$(t).modal("toggle")}))})(),$(document).ready((function(){$("#refreshImportantSettingsButton").click((()=>{t.getImportantSettings(n)})),$("#editImportantSettingsButton").click((()=>{let e=n.editImportantSettings();t.changeSettingsCamera(e,(e=>console.log(e)))})),$("#buttonImportantSettings").click((()=>{t.getImportantSettings(n)})),(e=>{$("#zoom_in_btn").off(),$("#zoom_out_btn").off(),$("#reset_btn").off(),$("#range_input").off();let t=Panzoom(e,{contain:"outside",startScale:-.125}),n=document.getElementById("zoom_in_btn"),a=document.getElementById("zoom_out_btn"),o=document.getElementById("reset_btn"),s=document.getElementById("range_input");n.addEventListener("click",t.zoomIn),a.addEventListener("click",t.zoomOut),o.addEventListener("click",t.reset),s.addEventListener("input",(e=>{t.zoom(e.target.valueAsNumber)}))})(document.getElementById("img_panzoom")),$("#editCurrCaptureSett").click((()=>{let e=$("#inputResizeCapture").val(),n=$("#inputCoeffCompressCapture").val();t.editCompressCurrCapture([n,e],console.log),console.log(pixelSize),console.log(compresSize)})),$("#inputResizeCapture").change((function(){console.log($(this).val())})),$("#get_settings_camera").click((()=>{t.getCameraConfig(n)})),$("#get_info_filesys").click((()=>{t.getInfoFilesys(_)})),$("#config_btn").click((()=>{t.getCameraConfig(renderTabsHtml)})),$("#get_all_files").click((()=>{t.getAllFiles(u)})),$("#refresh").click((()=>{t.syncWithCamera(m)})),$("#reload_btn").click((()=>{t.reloadCamera()})),$("#connect_to_camera").click((()=>{t.init($("#ip_input").val(),s)})),$("#capture").click((()=>{t.capture(c)})),$("#apply_settings").click((()=>{var e=n.parseCurrSettings();$($("#confirmModal  div.modal-body")[0]).html(function(){let t="",n=1;for(let a in e)t+=`<p> ${n++}. Значение <strong> ${a} </strong> на <strong> ${e[a]} </strong> </p>`;return t}()),$("#confirmModalBtn").one("click",(n=>{t.changeSettingsCamera(e,(e=>console.log(e)))}))}))}))})();